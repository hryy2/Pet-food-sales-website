name: Auto Deploy with Jenkins

on:
  push:
    branches:
      - main

jobs:
  deploy:
    name: Trigger Jenkins & Set GitHub Deployment
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # Step 1: Create deployment (for GitHub right-side display)
      - name: Start deployment
        id: deployment_start
        uses: bobheadxi/deployments@v1
        with:
          step: start
          token: ${{ secrets.PAT_TOKEN }}
          env: production
          desc: ğŸš€ å¼€å§‹è§¦å‘ Jenkins è‡ªåŠ¨éƒ¨ç½²

      # Step 2: Trigger Jenkins webhook (æ³¨æ„è¿™é‡Œå°±æ˜¯ä½ è‡ªå·±æœ¬åœ° Jenkins çš„ webhook åœ°å€)
      - name: Trigger Jenkins Webhook
        run: |
          curl -X POST ${{ secrets.JENKINS_WEBHOOK_URL }}

      # Step 3: æ ‡è®°éƒ¨ç½²æˆåŠŸï¼ˆè¿™é‡Œä½ ä¹Ÿå¯ä»¥æ ¹æ®æƒ…å†µæ·»åŠ å¤±è´¥çŠ¶æ€ï¼‰
      - name: Finish deployment
        uses: bobheadxi/deployments@v1
        with:
          step: finish
          token: ${{ secrets.PAT_TOKEN }}
          env: production
          status: success
          desc: âœ… Jenkins è‡ªåŠ¨éƒ¨ç½²å®Œæˆ
          deployment_id: ${{ steps.deployment_start.outputs.deployment_id }}
